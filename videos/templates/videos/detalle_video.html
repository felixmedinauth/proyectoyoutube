{% extends 'videos/base.html' %}

{% block title %}{{ video.titulo|default:"Ver Video" }} | YouTube Manager{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">

        <!-- ================= VIDEO PRINCIPAL ================= -->
        <div class="col-lg-8">
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-body p-0">
                    <div class="ratio ratio-16x9 bg-dark">
                        <iframe
                            src="https://www.youtube.com/embed/{{ video_id }}?rel=0"
                            title="YouTube Video Player"
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            allowfullscreen>
                        </iframe>
                    </div>
                </div>
            </div>

            <!-- ================= INFO DEL VIDEO ================= -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h2 class="mb-3">{{ video.titulo|default:"Video de YouTube" }}</h2>

                    <div class="mb-3">
                        <span class="badge bg-primary me-2">
                            <i class="fas fa-eye"></i> {{ video.vistas|default:0 }} vistas
                        </span>
                        <span class="badge bg-success me-2">
                            <i class="fas fa-thumbs-up"></i> {{ video.likes|default:0 }} likes
                        </span>
                        <span class="badge bg-info me-2">
                            <i class="fas fa-comments"></i> {{ video.comentarios|default:0 }} comentarios
                        </span>
                        <span class="badge bg-secondary">
                            <i class="fas fa-clock"></i> {{ video.duracion|default:"N/A" }}
                        </span>
                    </div>

                    <div class="d-flex align-items-center mb-3 pb-3 border-bottom">
                        <i class="fab fa-youtube fa-3x text-danger me-3"></i>
                        <div>
                            <h5 class="mb-0">{{ video.canal_nombre|default:"Mi Canal" }}</h5>
                            <small class="text-muted">
                                {{ video.fecha_publicacion|date:"d M Y"|default:"Reciente" }}
                            </small>
                        </div>
                        <div class="ms-auto">
                            <a href="https://www.youtube.com/channel/{{ video.canal_id }}"
                               target="_blank"
                               class="btn btn-danger">
                                <i class="fab fa-youtube"></i> Ver Canal
                            </a>
                        </div>
                    </div>

                    <div>
                        <h6 class="fw-bold">Descripción:</h6>
                        <p class="text-muted">
                            {{ video.descripcion|linebreaks|default:"Sin descripción disponible." }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- ================= BOTONES ================= -->
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-md-4">
                            <a href="https://www.youtube.com/watch?v={{ video_id }}"
                               target="_blank"
                               class="btn btn-danger w-100">
                                <i class="fab fa-youtube"></i> Ver en YouTube
                            </a>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-primary w-100" onclick="compartir()">
                                <i class="fas fa-share-alt"></i> Compartir
                            </button>
                        </div>
                        <div class="col-md-4">
                            <a href="{% url 'videos:mis_videos' %}" class="btn btn-secondary w-100">
                                <i class="fas fa-arrow-left"></i> Volver
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= SIDEBAR ================= -->
        <div class="col-lg-4">

            <!-- Resumen -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-dark text-white">
                    <h6 class="mb-0"><i class="fas fa-chart-bar"></i> Resumen de Impacto</h6>
                </div>
                <div class="card-body text-center">
                    <h4 class="text-primary mb-0">{{ video.vistas|default:0 }}</h4>
                    <small class="text-muted fw-bold">Visualizaciones</small>
                    <hr>
                    <h4 class="text-success mb-0">{{ video.likes|default:0 }}</h4>
                    <small class="text-muted fw-bold">Me gusta</small>
                </div>
            </div>

            <!-- Info técnica -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0"><i class="fas fa-info-circle"></i> Información Técnica</h6>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-6">Video ID:</dt>
                        <dd class="col-sm-6 text-truncate">
                            <code>{{ video_id }}</code>
                        </dd>
                        <dt class="col-sm-6">Categoría:</dt>
                        <dd class="col-sm-6">
                            <span class="badge bg-primary">
                                {{ video.categoria|default:"General" }}
                            </span>
                        </dd>
                    </dl>
                </div>
            </div>

            <!-- QR -->
            <div class="card shadow-sm text-center">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0"><i class="fas fa-qrcode"></i> Acceso Móvil</h6>
                </div>
                <div class="card-body">
                    <img
                        src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=https://www.youtube.com/watch?v={{ video_id }}"
                        alt="QR Code"
                        class="img-fluid rounded shadow-sm">
                    <p class="text-muted small mt-2 mb-0">
                        Escanea para ver el video en tu dispositivo
                    </p>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- ================= SCRIPTS ================= -->
<script>
function compartir() {
    const url = "https://www.youtube.com/watch?v={{ video_id }}";
    const titulo = "{{ video.titulo|escapejs }}";

    if (navigator.share) {
        navigator.share({ title: titulo, url: url })
            .catch(() => copiar(url));
    } else {
        copiar(url);
    }
}

function copiar(texto) {
    navigator.clipboard.writeText(texto).then(() => {
        alert("✅ URL copiada al portapapeles");
    });
}
</script>
{% endblock %}